Wedding Invitation Link Generator & URL Shortener
System Documentation & Workflow

This document serves as the complete technical blueprint for the dynamic wedding invitation system. It details how Google Sheets acts as a backend database to dynamically generate specific URL parameters that trigger conditional rendering on a React/Next.js frontend (sj-zeta.vercel.app), and how it automates URL shortening via the TinyURL API.

1. Google Sheets Architecture
The spreadsheet must adhere strictly to the following column layout for the logic to compute correctly.

Column A (Sr. No.): Serial number / row index.

Column B (Name): Guest's full name (spaces will be dynamically replaced with underscores).

Column C (Marriage): Guest count/type for the wedding (e.g., "Family", "2"). Maps to guests_wedding.

Column D (Madamandap): Guest count/type for the Mayra. Maps to guests_mayra.

Column E (Bhakti): Guest count/type for Bhakti Sandhya. Maps to guests_bhakti.

Column F (Lagan Lakhvanu): Guest count/type for the Reception. Maps to guests_reception.

Column G (event list): Autogenerated comma-separated list of events the guest is invited to.

Column H (link): Autogenerated long URL containing all conditional routing parameters.

Column I (shortened url): Autogenerated TinyURL link generated via Apps Script.

Rule for Missing Invites: If a guest is not invited to a specific event, leave the cell completely blank or enter a hyphen (-).

2. The Logic Engine (Formulas)
Column G: The Event List Generator
This column creates the explicit &event= parameter string required by the website's frontend router to know which event cards to render.

Formula (Paste in G2 and drag down):

Excel
=TEXTJOIN(",", TRUE, IF(OR(C2="", C2="-"), "", "wedding"), IF(OR(D2="", D2="-"), "", "mayra"), IF(OR(E2="", E2="-"), "", "bhakti"), IF(OR(F2="", F2="-"), "", "reception"))
How it works:

It evaluates Columns C, D, E, and F one by one.

IF(OR(C2="", C2="-"): Checks if the cell is blank OR contains a hyphen.

If true (uninvited), it outputs "" (nothing).

If false (invited), it outputs the specific system keyword (e.g., "wedding").

TEXTJOIN(",", TRUE, ...) takes all the valid outputs and merges them with a comma, ignoring the blanks.

Result: wedding,mayra

Column H: The Final Link Compiler
This column builds the actual URL to feed into the web application.

Formula (Paste in H2 and drag down):

Excel
="https://sj-zeta.vercel.app/?name="&SUBSTITUTE(B2," ","_") & IF(G2="","","&event="&G2) & IF(OR(C2="",C2="-"),"","&guests_wedding="&C2) & IF(OR(D2="",D2="-"),"","&guests_mayra="&D2) & IF(OR(E2="",E2="-"),"","&guests_bhakti="&E2) & IF(OR(F2="",F2="-"),"","&guests_reception="&F2)
How it works:

Base URL: Starts with https://sj-zeta.vercel.app/.

Name Parsing: SUBSTITUTE(B2," ","_") converts "Smt. Kokilaben L. Vora" to Smt._Kokilaben_L._Vora to prevent URL breaking.

Event Injection: IF(G2="","","&event="&G2) grabs the comma-separated list from Col G. If Col G is empty, it skips it.

Conditional Parameters: It repeats the OR(C2="", C2="-") check. If the cell has data (like "Family"), it appends &guests_wedding=Family. If it is blank/-, it completely omits that parameter from the URL, preventing the website from accidentally rendering uninvited events.

3. The Apps Script (TinyURL Automation)
Because the generated URLs in Column H are massive and visually unappealing for WhatsApp/SMS invites, a Google Apps Script runs to convert them into clean TinyURLs.

How to obtain the TinyURL API Key
Go to [suspicious link removed] and log in/create an account.

Navigate to the Dashboard.

Go to Settings > API (or developer section).

Click Create API Token.

Copy the generated string. This is your Bearer token (e.g., lcNXkcBoK...).

Script Breakdown (Line-by-Line Logic)
The script generateTinyURLs() is a backend JavaScript function running on Google's V8 engine.

Initialization: ```javascript
var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
var sourceColumn = 8; // Column H (Long Link)
var destinationColumn = 9; // Column I (Short Link)
var apiToken = "YOUR_API_KEY";

*Sets the target spreadsheet and declares where to read/write data.*

Data Extraction (Batching):

JavaScript
var lastRow = sheet.getLastRow();
var range = sheet.getRange(2, sourceColumn, lastRow - 1, 1);
var values = range.getValues();
var outputValues = [];
Instead of reading row by row (which is slow and crashes Google Sheets), it grabs the entire Col H array into memory at once.

Validation & Loop:

JavaScript
if (longUrl && longUrl.toString().indexOf("http") !== -1 && longUrl.toString().indexOf("tinyurl.com") === -1)
It loops through the data. It checks: Is there a URL? Does it have "http"? Is it ALREADY a tinyurl? If it is already shortened, it skips it to save API credits.

The API Request (UrlFetchApp):

JavaScript
var response = UrlFetchApp.fetch("https://api.tinyurl.com/create", {
  method: "post",
  headers: {
    "Authorization": "Bearer " + apiToken,
    "Content-Type": "application/json",
  },
  payload: JSON.stringify({ "url": longUrl, "domain": "tinyurl.com" }),
  muteHttpExceptions: true
});
This fires a POST request to TinyURL's server. It sends the apiToken to prove you have an account, and sends a JSON payload containing the long URL from Column H.

Parsing & Error Handling:

JavaScript
var json = JSON.parse(response.getContentText());
if (json.data && json.data.tiny_url) {
  outputValues.push([json.data.tiny_url]);
}
It takes the response from TinyURL, converts it back to a readable object, extracts just the tiny_url property, and pushes it into an array.

Rate Limiting:

JavaScript
Utilities.sleep(100); 
Crucial for preventing 429 (Too Many Requests) errors. It forces the script to wait 1/10th of a second between network calls.

Batch Write:

JavaScript
sheet.getRange(2, destinationColumn, outputValues.length, 1).setValues(outputValues);
Pastes the entire array of shortened URLs into Column I in one single, fast operation.

4. Standard Operating Procedure (How to use this daily)
When you have new guests to add to the list, follow these exact steps:

Add Data: Type the Guest Name (Col B) and their guest counts in Cols C, D, E, F.

Handle Blanks: If they are not invited to a specific event, leave that cell completely blank.

Extend Logic: Select cells G2 and H2. Double-click the blue square in the bottom right corner to drag the formulas down to your newly added rows. You will immediately see the long links generate.

Run Script: * Click Extensions > Apps Script.

Click the Run button at the top to execute generateTinyURLs.

Wait 5-10 seconds. Check Column I. The new TinyURLs will be populated and ready to send.